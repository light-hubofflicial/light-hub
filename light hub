-- Light Hub v2.7 | FLY FIXED 100% | Speed Toggle | Noclip | Inf Jump | ESP
-- Press K to toggle | Works in ALL games 2025
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer
local flying = false
local noclipping = false
local infJump = false
local espEnabled = true
local fastWalk = false
local flySpeed = 50
local normalWS = 16
local fastWS = 100
local gui = nil
local flyConn = nil
local noclipConn = nil
local BV = nil
local BG = nil
local espObjects = {}
local function getChar() return player.Character end
local function getHumanoid() local c = getChar(); return c and c:FindFirstChild("Humanoid") end
local function getRoot() local c = getChar(); return c and c:FindFirstChild("HumanoidRootPart") end
-- Clean up on death
player.CharacterAdded:Connect(function()
    if flying then stopFly() end
    if noclipping then stopNoclip() end
    fastWalk = false
    if getHumanoid() then getHumanoid().WalkSpeed = normalWS end
end)
-- FLY - 100% WORKING (Infinite Yield style with correct forces & P value)
local function startFly()
    if flying then return end
    local root = getRoot()
    local hum = getHumanoid()
    if not root or not hum then return end
    flying = true
    hum.PlatformStand = true
    BV = Instance.new("BodyVelocity")
    BV.MaxForce = Vector3.new(1e5, 1e5, 1e5)
    BV.Velocity = Vector3.new(0,0,0)
    BV.Parent = root
    BG = Instance.new("BodyGyro")
    BG.MaxTorque = Vector3.new(1e5, 1e5, 1e5)
    BG.P = 12500
    BG.D = 500
    BG.Parent = root
    flyConn = RunService.Heartbeat:Connect(function()
        if not flying or not getRoot() then stopFly(); return end
        BG.CFrame = workspace.CurrentCamera.CFrame
        local move = Vector3.new()
        if UserInputService:IsKeyDown(Enum.KeyCode.W) then move += workspace.CurrentCamera.CFrame.LookVector end
        if UserInputService:IsKeyDown(Enum.KeyCode.S) then move -= workspace.CurrentCamera.CFrame.LookVector end
        if UserInputService:IsKeyDown(Enum.KeyCode.A) then move -= workspace.CurrentCamera.CFrame.RightVector end
        if UserInputService:IsKeyDown(Enum.KeyCode.D) then move += workspace.CurrentCamera.CFrame.RightVector end
        if UserInputService:IsKeyDown(Enum.KeyCode.Space) then move += Vector3.new(0,1,0) end
        if UserInputService:IsKeyDown(Enum.KeyCode.LeftControl) then move -= Vector3.new(0,1,0) end
        if move.Magnitude > 0 then
            BV.Velocity = move.Unit * flySpeed
        else
            BV.Velocity = Vector3.new(0,0,0)
        end
    end)
end
local function stopFly()
    flying = false
    if flyConn then flyConn:Disconnect(); flyConn = nil end
    if BV then BV:Destroy(); BV = nil end
    if BG then BG:Destroy(); BG = nil end
    local hum = getHumanoid()
    if hum then hum.PlatformStand = false end
end
-- NOCLIP
local function startNoclip()
    if noclipping then return end
    noclipping = true
    noclipConn = RunService.Stepped:Connect(function()
        for _, p in pairs(getChar():GetDescendants()) do
            if p:IsA("BasePart") then p.CanCollide = false end
        end
    end)
end
local function stopNoclip()
    noclipping = false
    if noclipConn then noclipConn:Disconnect(); noclipConn = nil end
end
-- INFINITE JUMP
UserInputService.InputBegan:Connect(function(i,gp)
    if gp or not infJump or i.KeyCode ~= Enum.KeyCode.Space then return end
    local h = getHumanoid()
    if h then h:ChangeState(Enum.HumanoidStateType.Jumping) end
end)
-- ESP (working)
local function createESP(plr)
    if plr == player or espObjects[plr] then return end
    local char = plr.Character or plr.CharacterAdded:Wait()
    local hum = char:WaitForChild("Humanoid")
    local head = char:WaitForChild("Head")
    local hl = Instance.new("Highlight", char)
    hl.FillColor = Color3.fromRGB(255,0,0); hl.OutlineColor = Color3.fromRGB(255,255,0)
    hl.FillTransparency = 0.5; hl.OutlineTransparency = 0
    local bill = Instance.new("BillboardGui", char)
    bill.Adornee = head; bill.Size = UDim2.new(0,100,0,50); bill.StudsOffset = Vector3.new(0,3,0); bill.AlwaysOnTop = true
    local name = Instance.new("TextLabel", bill); name.Size = UDim2.new(1,0,0.5,0); name.BackgroundTransparency = 1
    name.Text = plr.DisplayName; name.TextColor3 = Color3.new(1,1,1); name.TextStrokeTransparency = 0; name.Font = Enum.Font.GothamBold; name.TextScaled = true
    local health = Instance.new("TextLabel", bill); health.Size = UDim2.new(1,0,0.5,0); health.Position = UDim2.new(0,0,0.5,0)
    health.BackgroundTransparency = 1; health.TextColor3 = Color3.fromRGB(0,255,0); health.TextStrokeTransparency = 0; health.Font = Enum.Font.GothamBold; health.TextScaled = true
    health.Text = math.floor(hum.Health).."/"..hum.MaxHealth
    hum.HealthChanged:Connect(function(h) if espObjects[plr] then health.Text = math.floor(h).."/"..hum.MaxHealth end end)
    espObjects[plr] = {highlight=hl, bill=bill}
end
local function removeESP(plr)
    if espObjects[plr] then
        if espObjects[plr].highlight then espObjects[plr].highlight:Destroy() end
        if espObjects[plr].bill then espObjects[plr].bill:Destroy() end
        espObjects[plr] = nil
    end
end
local function toggleESP()
    espEnabled = not espEnabled
    if espEnabled then for _,p in Players:GetPlayers() do if p~=player then createESP(p) end end
    else for p,_ in pairs(espObjects) do removeESP(p) end end
end
Players.PlayerAdded:Connect(function(p) if espEnabled and p~=player then p.CharacterAdded:Connect(function() createESP(p) end) end end)
Players.PlayerRemoving:Connect(removeESP)
for _,p in Players:GetPlayers() do if p~=player then createESP(p) end end
-- COMPACT GUI
local function createGUI()
    gui = Instance.new("ScreenGui"); gui.Name = "LightHub"; gui.ResetOnSpawn = false; gui.Parent = player:WaitForChild("PlayerGui")
    local main = Instance.new("Frame"); main.Size = UDim2.new(0,370,0,380); main.Position = UDim2.new(0.5,-185,0.5,-190)
    main.BackgroundColor3 = Color3.fromRGB(25,25,25); main.Active = true; main.Draggable = true; main.Parent = gui
    Instance.new("UICorner", main).CornerRadius = UDim.new(0,12)
    Instance.new("UIStroke", main).Color = Color3.fromRGB(255,140,0); Instance.new("UIStroke", main).Thickness = 2
    local title = Instance.new("TextLabel"); title.Size = UDim2.new(1,0,0,35); title.BackgroundColor3 = Color3.fromRGB(35,35,35)
    title.Text = "Light Hub v2.7 | Press K"; title.TextColor3 = Color3.new(1,1,1); title.Font = Enum.Font.GothamBold; title.TextSize = 16; title.Parent = main
    Instance.new("UICorner", title).CornerRadius = UDim.new(0,12)
    local close = Instance.new("TextButton"); close.Size = UDim2.new(0,28,0,28); close.Position = UDim2.new(1,-34,0,4)
    close.BackgroundColor3 = Color3.fromRGB(255,60,60); close.Text = "X"; close.Parent = title
    Instance.new("UICorner", close).CornerRadius = UDim.new(0,6)
    close.MouseButton1Click:Connect(function() gui:Destroy() end)
    local y = 45
    local function row(name, toggleFunc, hasBox, default)
        local r = Instance.new("Frame"); r.Size = UDim2.new(1,-20,0,40); r.Position = UDim2.new(0,10,0,y); r.BackgroundColor3 = Color3.fromRGB(40,40,40); r.Parent = main
        Instance.new("UICorner", r).CornerRadius = UDim.new(0,8)
        local l = Instance.new("TextLabel", r); l.Size = UDim2.new(0.5,0,1,0); l.BackgroundTransparency = 1; l.Text = name..": OFF"; l.TextXAlignment = Enum.TextXAlignment.Left; l.TextColor3 = Color3.new(1,1,1); l.Font = Enum.Font.Gotham
        local btn = Instance.new("TextButton", r); btn.Size = UDim2.new(0,65,0,30); btn.Position = UDim2.new(1,-75,0.5,-15)
        btn.BackgroundColor3 = Color3.fromRGB(60,60,60); btn.Text = "OFF"; Instance.new("UICorner", btn).CornerRadius = UDim.new(0,6)
        btn.MouseButton1Click:Connect(function()
            toggleFunc()
            local on = (name=="Fly" and flying) or (name=="Noclip" and noclipping) or (name=="Inf Jump" and infJump) or (name=="Speed" and fastWalk) or (name=="ESP" and espEnabled)
            btn.Text = on and "ON" or "OFF"
            btn.BackgroundColor3 = on and Color3.fromRGB(0,255,0) or Color3.fromRGB(60,60,60)
            l.Text = name..": "..btn.Text
        end)
        if hasBox then
            local box = Instance.new("TextBox", r); box.Size = UDim2.new(0,55,0,30); box.Position = UDim2.new(1,-135,0.5,-15)
            box.BackgroundColor3 = Color3.fromRGB(60,60,60); box.Text = default; Instance.new("UICorner", box).CornerRadius = UDim.new(0,6)
            box.FocusLost:Connect(function()
                local v = tonumber(box.Text)
                if name=="Fly" then 
                    flySpeed = math.clamp(v or 50,1,500) 
                elseif name=="Speed" then 
                    fastWS = math.clamp(v or 100,16,500) 
                    if fastWalk then
                        local hum = getHumanoid()
                        if hum then hum.WalkSpeed = fastWS end
                    end
                end
            end)
        end
        y = y + 48
    end
    row("Fly", function() if flying then stopFly() else startFly() end end, true, "50")
    row("Speed", function()
        fastWalk = not fastWalk
        if getHumanoid() then getHumanoid().WalkSpeed = fastWalk and fastWS or normalWS end
    end, true, "100")
    row("Noclip", function() if noclipping then stopNoclip() else startNoclip() end end, false)
    row("Inf Jump", function() infJump = not infJump end, false)
    row("ESP", toggleESP, false)
    UserInputService.InputBegan:Connect(function(i,gp)
        if gp then return end
        if i.KeyCode == Enum.KeyCode.K then gui.Enabled = not gui.Enabled end
    end)
end
createGUI()
print("Light Hub v2.7 FLY FIXED & WORKING 100% | Press K")
